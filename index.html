<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Deep Research Skill Factory - Aviram OS</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-dark: #0a0b0d;
      --bg-medium: #14161a;
      --bg-light: #1e2127;
      --glass-bg: rgba(30, 33, 39, 0.4);
      --glass-border: rgba(255, 255, 255, 0.08);
      --glass-highlight: rgba(255, 255, 255, 0.03);
      --text-primary: #e8eaed;
      --text-secondary: #9aa0a6;
      --accent-primary: #8ab4f8;
      --accent-secondary: #81c995;
      --shadow-color: rgba(0, 0, 0, 0.5);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #0a0b0d 0%, #14161a 50%, #1e2127 100%);
      background-attachment: fixed;
      min-height: 100vh;
      padding: 24px;
      position: relative;
      overflow-x: hidden;
      color: var(--text-primary);
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 30%, rgba(138, 180, 248, 0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(129, 201, 149, 0.02) 0%, transparent 50%),
        radial-gradient(circle at 50% 50%, rgba(255, 255, 255, 0.01) 0%, transparent 80%);
      pointer-events: none;
      animation: ambientShift 30s ease-in-out infinite;
      z-index: 0;
    }

    @keyframes ambientShift {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.1); }
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      position: relative;
      z-index: 1;
    }

    .aviram-surface {
      backdrop-filter: blur(20px) saturate(120%);
      -webkit-backdrop-filter: blur(20px) saturate(120%);
      background: var(--glass-bg);
      border-radius: 20px;
      border: 1px solid var(--glass-border);
      box-shadow:
        0 8px 32px var(--shadow-color),
        inset 0 1px 0 var(--glass-highlight);
      padding: 32px;
      margin-bottom: 24px;
      contain: layout style paint;
      will-change: backdrop-filter, transform;
      transform: translate3d(0, 0, 0);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .aviram-surface:hover {
      backdrop-filter: blur(24px) saturate(140%);
      -webkit-backdrop-filter: blur(24px) saturate(140%);
      background: rgba(30, 33, 39, 0.5);
      border-color: rgba(255, 255, 255, 0.12);
      transform: translate3d(0, -2px, 0);
      box-shadow:
        0 12px 48px var(--shadow-color),
        inset 0 1px 0 rgba(255, 255, 255, 0.06);
    }

    .aviram-surface::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(90deg,
        transparent 0%,
        var(--accent-primary) 50%,
        transparent 100%);
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .aviram-surface:hover::before {
      opacity: 0.5;
    }

    .header-surface {
      backdrop-filter: blur(30px) saturate(140%);
      -webkit-backdrop-filter: blur(30px) saturate(140%);
      background: rgba(30, 33, 39, 0.5);
      border-radius: 24px;
      padding: 48px 40px;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    h1 {
      font-size: 48px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-primary) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 12px;
      letter-spacing: -1px;
      line-height: 1.1;
    }

    .subtitle {
      color: var(--text-secondary);
      font-size: 16px;
      font-weight: 500;
      letter-spacing: 0.3px;
    }

    .stepper {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 32px 0;
      padding: 12px 0;
      position: relative;
    }

    .step {
      display: flex;
      flex-direction: column;
      align-items: center;
      flex: 1;
      position: relative;
      z-index: 2;
    }

    .step-circle {
      width: 64px;
      height: 64px;
      border-radius: 50%;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      background: rgba(30, 33, 39, 0.6);
      border: 2px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 20px;
      color: var(--text-secondary);
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .step-circle::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: conic-gradient(
        var(--accent-primary) 0deg,
        transparent 90deg
      );
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .step-circle.active {
      background: rgba(138, 180, 248, 0.15);
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      transform: scale(1.15);
      box-shadow:
        0 8px 32px rgba(138, 180, 248, 0.3),
        0 0 40px rgba(138, 180, 248, 0.2);
    }

    .step-circle.active::before {
      opacity: 0.3;
      animation: rotate 3s linear infinite;
    }

    @keyframes rotate {
      to { transform: rotate(360deg); }
    }

    .step-circle.complete {
      background: rgba(129, 201, 149, 0.15);
      border-color: var(--accent-secondary);
      color: var(--accent-secondary);
      box-shadow: 0 0 24px rgba(129, 201, 149, 0.3);
    }

    .step-label {
      margin-top: 14px;
      font-size: 13px;
      color: var(--text-secondary);
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      transition: color 0.3s ease;
    }

    .step-label.active {
      color: var(--accent-primary);
    }

    .step-line {
      position: absolute;
      top: 32px;
      left: 50%;
      width: 100%;
      height: 2px;
      background: rgba(255, 255, 255, 0.05);
      z-index: 1;
      transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .step-line::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 0;
      background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 12px currentColor;
    }

    .step-line.complete::after {
      width: 100%;
    }

    .step:last-child .step-line {
      display: none;
    }

    textarea {
      width: 100%;
      height: 240px;
      padding: 20px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      background: rgba(20, 22, 26, 0.5);
      border: 1.5px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      font-size: 14px;
      line-height: 1.6;
      color: var(--text-primary);
      resize: vertical;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    textarea::placeholder {
      color: var(--text-secondary);
      opacity: 0.6;
    }

    textarea:focus {
      outline: none;
      background: rgba(20, 22, 26, 0.7);
      border-color: var(--accent-primary);
      box-shadow:
        inset 0 2px 8px rgba(0, 0, 0, 0.3),
        0 0 24px rgba(138, 180, 248, 0.2);
    }

    .btn {
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      background: rgba(138, 180, 248, 0.15);
      border: 1.5px solid var(--accent-primary);
      color: var(--accent-primary);
      padding: 18px 36px;
      border-radius: 14px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 4px 20px rgba(138, 180, 248, 0.2);
      text-shadow: 0 0 20px rgba(138, 180, 248, 0.5);
      transform: translate3d(0, 0, 0);
      position: relative;
      overflow: hidden;
    }

    .btn::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg,
        rgba(138, 180, 248, 0.2),
        rgba(129, 201, 149, 0.2));
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .btn:hover:not(:disabled)::before {
      opacity: 1;
    }

    .btn:hover:not(:disabled) {
      background: rgba(138, 180, 248, 0.25);
      border-color: rgba(138, 180, 248, 0.8);
      transform: translate3d(0, -3px, 0) scale(1.02);
      box-shadow:
        0 8px 32px rgba(138, 180, 248, 0.3),
        0 0 40px rgba(138, 180, 248, 0.2);
    }

    .btn:active:not(:disabled) {
      transform: translate3d(0, 0, 0) scale(0.98);
    }

    .btn:disabled {
      background: rgba(30, 33, 39, 0.5);
      border-color: rgba(255, 255, 255, 0.05);
      color: var(--text-secondary);
      cursor: not-allowed;
      opacity: 0.5;
      text-shadow: none;
    }

    .btn.success {
      background: rgba(129, 201, 149, 0.15);
      border-color: var(--accent-secondary);
      color: var(--accent-secondary);
      box-shadow:
        0 4px 20px rgba(129, 201, 149, 0.2),
        0 0 30px rgba(129, 201, 149, 0.15);
    }

    .btn.success:hover {
      background: rgba(129, 201, 149, 0.25);
      box-shadow:
        0 8px 32px rgba(129, 201, 149, 0.3),
        0 0 40px rgba(129, 201, 149, 0.2);
    }

    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
      flex-wrap: wrap;
    }

    .button-group .btn {
      flex: 1;
      min-width: 200px;
      margin-top: 0;
    }

    .btn-secondary {
      background: rgba(100, 100, 120, 0.2);
      border-color: rgba(255, 255, 255, 0.3);
      color: var(--text-primary);
      box-shadow: 0 4px 20px rgba(100, 100, 120, 0.2);
    }

    .btn-secondary:hover:not(:disabled) {
      background: rgba(100, 100, 120, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      box-shadow:
        0 8px 32px rgba(100, 100, 120, 0.3),
        0 0 40px rgba(100, 100, 120, 0.2);
    }

    @media (max-width: 768px) {
      .button-group {
        flex-direction: column;
      }

      .button-group .btn {
        width: 100%;
        min-width: 0;
      }
    }

    .progress-bar {
      width: 100%;
      height: 6px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(20, 22, 26, 0.6);
      border-radius: 8px;
      overflow: hidden;
      margin: 24px 0;
      box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.05);
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg,
        var(--accent-primary),
        var(--accent-secondary));
      transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 0 20px currentColor;
      border-radius: 8px;
      position: relative;
    }

    .progress-fill::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .progress-text {
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      color: var(--text-secondary);
      margin-bottom: 12px;
      font-weight: 600;
      letter-spacing: 0.3px;
    }

    .log-container {
      max-height: 520px;
      overflow-y: auto;
      padding: 20px;
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      background: rgba(10, 11, 13, 0.6);
      border-radius: 16px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: inset 0 2px 12px rgba(0, 0, 0, 0.5);
    }

    .log-container::-webkit-scrollbar {
      width: 6px;
    }

    .log-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 4px;
    }

    .log-container::-webkit-scrollbar-thumb {
      background: rgba(138, 180, 248, 0.3);
      border-radius: 4px;
      transition: background 0.3s ease;
    }

    .log-container::-webkit-scrollbar-thumb:hover {
      background: rgba(138, 180, 248, 0.5);
    }

    .log-entry {
      padding: 14px 18px;
      margin-bottom: 10px;
      border-radius: 12px;
      font-size: 13px;
      line-height: 1.7;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.3);
      transform: translate3d(0, 0, 0);
      animation: logEntryAppear 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes logEntryAppear {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .log-entry.info {
      background: rgba(138, 180, 248, 0.08);
      border-color: rgba(138, 180, 248, 0.2);
      color: #aec7fa;
    }

    .log-entry.success {
      background: rgba(129, 201, 149, 0.08);
      border-color: rgba(129, 201, 149, 0.2);
      color: #a8dab5;
    }

    .log-entry.warning {
      background: rgba(251, 188, 5, 0.08);
      border-color: rgba(251, 188, 5, 0.2);
      color: #fdd663;
    }

    .log-entry.error {
      background: rgba(242, 139, 130, 0.08);
      border-color: rgba(242, 139, 130, 0.2);
      color: #f8b4ae;
    }

    .log-time {
      font-family: 'SF Mono', monospace;
      font-size: 11px;
      opacity: 0.6;
      margin-right: 12px;
      letter-spacing: 0.5px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    @media (max-width: 1024px) {
      .grid {
        grid-template-columns: 1fr;
      }

      .aviram-surface {
        backdrop-filter: blur(12px) saturate(110%);
        -webkit-backdrop-filter: blur(12px) saturate(110%);
      }

      textarea {
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
      }
    }

    @media (prefers-contrast: high) {
      .aviram-surface {
        background: rgba(30, 33, 39, 0.95);
        backdrop-filter: none;
        border: 2px solid rgba(255, 255, 255, 0.3);
      }

      textarea {
        background: rgba(10, 11, 13, 0.95);
        border: 2px solid rgba(255, 255, 255, 0.3);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    .examples {
      margin-top: 24px;
      padding-top: 24px;
      border-top: 1px solid rgba(255, 255, 255, 0.08);
    }

    .example-btn {
      display: block;
      background: none;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      padding: 12px 18px;
      text-align: left;
      font-size: 14px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      border-radius: 10px;
      margin-bottom: 8px;
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      width: 100%;
      border: 1px solid transparent;
    }

    .example-btn:hover {
      background: rgba(138, 180, 248, 0.08);
      border-color: rgba(138, 180, 248, 0.2);
      color: var(--accent-primary);
      padding-left: 24px;
      box-shadow: 0 2px 12px rgba(138, 180, 248, 0.1);
    }

    .status-badge {
      display: inline-block;
      padding: 12px 24px;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      margin: 16px 0;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
      letter-spacing: 0.3px;
    }

    .status-badge.success {
      background: rgba(129, 201, 149, 0.12);
      border-color: rgba(129, 201, 149, 0.4);
      color: var(--accent-secondary);
      box-shadow:
        0 4px 16px rgba(129, 201, 149, 0.2),
        0 0 24px rgba(129, 201, 149, 0.1);
    }

    .status-badge.error {
      background: rgba(242, 139, 130, 0.12);
      border-color: rgba(242, 139, 130, 0.4);
      color: #f8b4ae;
      box-shadow:
        0 4px 16px rgba(242, 139, 130, 0.2),
        0 0 24px rgba(242, 139, 130, 0.1);
    }

    .file-tree {
      margin-top: 24px;
      font-family: 'SF Mono', 'Courier New', monospace;
      font-size: 13px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(10, 11, 13, 0.4);
      padding: 18px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      line-height: 1.8;
    }

    .file-item {
      padding: 4px 0;
      padding-left: 20px;
      color: var(--text-secondary);
      transition: color 0.2s ease;
    }

    .file-item:hover {
      color: var(--accent-primary);
    }

    .file-item.folder {
      font-weight: 600;
      color: var(--accent-primary);
    }

    .hidden {
      display: none;
    }

    .loading-spinner {
      border: 3px solid rgba(138, 180, 248, 0.2);
      border-top: 3px solid var(--accent-primary);
      border-radius: 50%;
      width: 18px;
      height: 18px;
      animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite;
      display: inline-block;
      margin-left: 12px;
      vertical-align: middle;
      box-shadow: 0 0 20px rgba(138, 180, 248, 0.3);
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .reset-link {
      color: var(--text-secondary);
      cursor: pointer;
      text-decoration: none;
      font-size: 13px;
      float: right;
      font-weight: 600;
      padding: 10px 18px;
      border-radius: 10px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      background: rgba(138, 180, 248, 0.08);
      border: 1px solid rgba(138, 180, 248, 0.2);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      letter-spacing: 0.3px;
      text-transform: uppercase;
    }

    .reset-link:hover {
      background: rgba(138, 180, 248, 0.15);
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      box-shadow: 0 2px 12px rgba(138, 180, 248, 0.2);
    }

    h2 {
      color: var(--text-primary);
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 20px;
      letter-spacing: -0.3px;
    }

    h3 {
      color: var(--text-primary);
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 12px;
      letter-spacing: 0.3px;
      text-transform: uppercase;
      opacity: 0.9;
    }

    p {
      color: var(--text-secondary);
      line-height: 1.7;
    }

    .system-status {
      position: fixed;
      bottom: 24px;
      right: 24px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent-secondary);
      box-shadow:
        0 0 20px var(--accent-secondary),
        0 0 40px rgba(129, 201, 149, 0.3);
      animation: pulse 3s ease-in-out infinite;
      z-index: 1000;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    .api-config {
      margin-bottom: 24px;
      padding: 20px;
      background: rgba(251, 188, 5, 0.08);
      border: 1px solid rgba(251, 188, 5, 0.2);
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .api-config.collapsed {
      background: rgba(129, 201, 149, 0.08);
      border-color: rgba(129, 201, 149, 0.3);
      padding: 16px 20px;
    }

    .api-config-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .api-config-status {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .api-config-status .check-icon {
      color: var(--accent-secondary);
      font-size: 18px;
      font-weight: bold;
    }

    .api-config-status .status-text {
      color: var(--accent-secondary);
      font-weight: 600;
      font-size: 14px;
    }

    .api-config-actions {
      display: flex;
      gap: 8px;
    }

    .api-config-btn {
      padding: 6px 14px;
      font-size: 12px;
      font-weight: 600;
      border-radius: 8px;
      border: 1px solid;
      background: rgba(255, 255, 255, 0.05);
      cursor: pointer;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .api-config-btn.edit {
      color: var(--accent-primary);
      border-color: rgba(138, 180, 248, 0.3);
    }

    .api-config-btn.edit:hover {
      background: rgba(138, 180, 248, 0.1);
      border-color: var(--accent-primary);
    }

    .api-config-btn.clear {
      color: #f8b4ae;
      border-color: rgba(242, 139, 130, 0.3);
    }

    .api-config-btn.clear:hover {
      background: rgba(242, 139, 130, 0.1);
      border-color: rgba(242, 139, 130, 0.5);
    }

    .api-config-form {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .api-config-form.hidden {
      display: none;
    }

    .api-config input {
      width: 100%;
      padding: 12px 16px;
      background: rgba(10, 11, 13, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: var(--text-primary);
      font-family: 'SF Mono', monospace;
      font-size: 13px;
      margin-top: 8px;
    }

    .api-config input:focus {
      outline: none;
      border-color: var(--accent-primary);
      box-shadow: 0 0 12px rgba(138, 180, 248, 0.2);
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="aviram-surface header-surface">
      <h1>🏭 Deep Research Skill Factory</h1>
      <p class="subtitle">SKILL FACTORY • TURN WORKFLOWS INTO CLAUDE SUPERPOWERS</p>
    </div>

    <div class="aviram-surface">
      <div class="stepper" id="stepper"></div>
    </div>

    <div class="grid">
      <div>
        <div class="aviram-surface" id="inputCard">
          <div class="api-config" id="apiConfig">
            <!-- Collapsed State (shown when API key is saved) -->
            <div class="api-config-header hidden" id="apiConfigCollapsed">
              <div class="api-config-status">
                <span class="check-icon">✓</span>
                <span class="status-text">API Key Configured</span>
              </div>
              <div class="api-config-actions">
                <button class="api-config-btn edit" onclick="expandApiConfig()">Edit</button>
                <button class="api-config-btn clear" onclick="clearApiKey()">Clear</button>
              </div>
            </div>

            <!-- Expanded State (shown on first visit or when editing) -->
            <div class="api-config-form" id="apiConfigForm">
              <h3>⚙️ API Configuration</h3>
              <p style="font-size: 13px; margin-bottom: 8px;">Enter your Anthropic API key to enable skill generation:</p>
              <input
                type="password"
                id="apiKey"
                placeholder="sk-ant-..."
                autocomplete="off"
                onchange="saveApiKey()"
                onkeypress="if(event.key === 'Enter') saveApiKey()"
              />
              <p style="font-size: 11px; margin-top: 8px; opacity: 0.7;">Your key is stored locally in your browser only. Get one at console.anthropic.com</p>
            </div>
          </div>

          <h2>What do you want Claude to know how to do?</h2>
          <p style="color: var(--text-secondary); margin-bottom: 20px; line-height: 1.6;">
            Think of a workflow you repeat. A technical thing you explain constantly. A pattern you wish Claude just *knew*. Write it here. The system researches, architects, and packages it into a skill Claude can use forever.
          </p>
          <textarea
            id="skillInput"
            placeholder="Real examples that work:

• Parse PDF tables into clean JSON, handle malformed data gracefully
• Build type-safe React forms with accessible error states
• Wrap REST APIs with auth refresh, retry logic, request deduplication

The more texture you give, the sharper the output. But even 'email automation' is enough to start."
          ></textarea>
          <button class="btn" id="generateBtn" onclick="startGeneration()">
            Generate This Skill →
          </button>

          <div class="examples">
            <h3>Skills People Actually Use</h3>
            <button class="example-btn" onclick="setExample('Parse PDF tables and forms into structured JSON. Handle malformed PDFs, extract nested tables, preserve formatting context.')">→ PDF parsing with error handling</button>
            <button class="example-btn" onclick="setExample('Build accessible React forms with real-time validation, error recovery, and keyboard navigation. Include ARIA labels and focus management.')">→ Production-grade React forms</button>
            <button class="example-btn" onclick="setExample('Create REST API clients with token refresh, exponential backoff, request deduplication, and typed responses.')">→ Industrial-strength API wrappers</button>
          </div>
        </div>

        <div class="aviram-surface hidden" id="progressCard">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
            <h2 style="margin: 0;">Progress</h2>
            <a class="reset-link" onclick="resetFactory()">← New</a>
          </div>

          <div id="progressSection">
            <div class="progress-text">
              <span id="progressStage">Initializing...</span>
              <span id="progressPercent">0%</span>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <p id="progressMessage" style="margin-top: 14px; font-size: 14px;"></p>
          </div>

          <div id="resultsSection" class="hidden">
            <div class="status-badge success">
              ✓ Generation Complete
            </div>
            <p id="qualityScore" style="margin: 12px 0;"></p>

            <div class="button-group">
              <button class="btn success" id="downloadBtn" onclick="downloadSkill()">
                ⬇️ Download Skill Package
              </button>
              <button class="btn btn-secondary" id="copyPromptBtn" onclick="copyPromptToClipboard()">
                📋 Copy Prompt
              </button>
            </div>

            <div id="fileTree" class="file-tree"></div>
          </div>

          <div id="errorSection" class="hidden">
            <div class="status-badge error">
              ✗ Generation Failed
            </div>
            <p id="errorMessage" style="margin: 12px 0;"></p>
            <button class="btn" onclick="resetFactory()">Try Again</button>
          </div>
        </div>
      </div>

      <div class="aviram-surface">
        <h2>Generation Log</h2>
        <div class="log-container" id="logContainer">
          <p style="color: var(--text-secondary); opacity: 0.6;">Logs will appear here during generation...</p>
        </div>
      </div>
    </div>
  </div>

  <div class="system-status" title="System Ready"></div>

  <script>
    function initAviramContext() {
      const supportsBackdropFilter = CSS.supports('backdrop-filter', 'blur(1px)') ||
                                     CSS.supports('-webkit-backdrop-filter', 'blur(1px)');

      if (!supportsBackdropFilter) {
        console.warn('Backdrop filter not supported - using fallback');
        document.querySelectorAll('.aviram-surface').forEach(el => {
          el.style.background = 'rgba(30, 33, 39, 0.95)';
        });
      }

      document.querySelectorAll('.aviram-surface').forEach(surface => {
        surface.addEventListener('mouseenter', function() {
          this.style.willChange = 'backdrop-filter, transform';
        });

        surface.addEventListener('mouseleave', function() {
          this.style.willChange = 'auto';
        });
      });
    }

    let currentStep = 0;
    let generatedSkillData = null;
    let isGenerating = false;

    const steps = ['Input', 'Research', 'Generate', 'Validate', 'Package'];
    const API_KEY_STORAGE_KEY = 'anthropic_api_key';

    // API Key localStorage Management
    function loadApiKey() {
      const savedKey = localStorage.getItem(API_KEY_STORAGE_KEY);
      if (savedKey) {
        document.getElementById('apiKey').value = savedKey;
        collapseApiConfig();
      }
    }

    function saveApiKey() {
      const apiKey = document.getElementById('apiKey').value.trim();
      if (apiKey) {
        localStorage.setItem(API_KEY_STORAGE_KEY, apiKey);
        collapseApiConfig();
        addLog('API key saved locally', 'success');
      }
    }

    function collapseApiConfig() {
      const apiConfig = document.getElementById('apiConfig');
      const collapsedView = document.getElementById('apiConfigCollapsed');
      const formView = document.getElementById('apiConfigForm');

      apiConfig.classList.add('collapsed');
      collapsedView.classList.remove('hidden');
      formView.classList.add('hidden');
    }

    function expandApiConfig() {
      const apiConfig = document.getElementById('apiConfig');
      const collapsedView = document.getElementById('apiConfigCollapsed');
      const formView = document.getElementById('apiConfigForm');

      apiConfig.classList.remove('collapsed');
      collapsedView.classList.add('hidden');
      formView.classList.remove('hidden');

      // Focus the input field
      document.getElementById('apiKey').focus();
    }

    function clearApiKey() {
      if (confirm('Are you sure you want to clear your saved API key?')) {
        localStorage.removeItem(API_KEY_STORAGE_KEY);
        document.getElementById('apiKey').value = '';
        expandApiConfig();
        addLog('API key cleared', 'info');
      }
    }

    function init() {
      initAviramContext();
      renderStepper();
      loadApiKey();
    }

    function renderStepper() {
      const stepper = document.getElementById('stepper');
      stepper.innerHTML = '';

      steps.forEach((stepName, index) => {
        const step = document.createElement('div');
        step.className = 'step';

        const circle = document.createElement('div');
        circle.className = 'step-circle';
        if (index === currentStep) circle.classList.add('active');
        if (index < currentStep) circle.classList.add('complete');
        circle.textContent = index < currentStep ? '✓' : index + 1;

        const label = document.createElement('div');
        label.className = 'step-label';
        if (index === currentStep) label.classList.add('active');
        label.textContent = stepName;

        const line = document.createElement('div');
        line.className = 'step-line';
        if (index < currentStep) line.classList.add('complete');

        step.appendChild(circle);
        step.appendChild(label);
        step.appendChild(line);
        stepper.appendChild(step);
      });
    }

    function setStep(step) {
      currentStep = step;
      renderStepper();
    }

    function setExample(text) {
      document.getElementById('skillInput').value = text;
    }

    function addLog(message, type = 'info') {
      const container = document.getElementById('logContainer');

      if (container.querySelector('p')) {
        container.innerHTML = '';
      }

      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;

      const time = new Date().toLocaleTimeString();
      entry.innerHTML = `<span class="log-time">${time}</span>${message}`;

      container.appendChild(entry);
      container.scrollTop = container.scrollHeight;
    }

    function updateProgress(stage, percent, message) {
      document.getElementById('progressStage').textContent = stage;
      document.getElementById('progressPercent').textContent = `${percent}%`;
      document.getElementById('progressFill').style.width = `${percent}%`;
      document.getElementById('progressMessage').textContent = message;
    }

    function showError(message) {
      document.getElementById('progressSection').classList.add('hidden');
      document.getElementById('errorSection').classList.remove('hidden');
      document.getElementById('errorMessage').textContent = message;
    }

    function showResults(validation, tree, filename) {
      document.getElementById('progressSection').classList.add('hidden');
      document.getElementById('resultsSection').classList.remove('hidden');
      document.getElementById('qualityScore').textContent = `Quality Score: ${validation.qualityScore}/100`;

      const treeHtml = renderFileTree(tree);
      document.getElementById('fileTree').innerHTML = `<strong style="color: var(--accent-primary);">📦 Package Contents</strong>${treeHtml}`;
    }

    function renderFileTree(node, depth = 0) {
      let html = '';
      const indent = '  '.repeat(depth);

      if (node.type === 'folder') {
        html += `<div class="file-item folder">${indent}📁 ${node.name}/</div>`;
        if (node.children) {
          node.children.forEach(child => {
            html += renderFileTree(child, depth + 1);
          });
        }
      } else {
        const size = node.size ? ` (${(node.size / 1024).toFixed(1)} KB)` : '';
        html += `<div class="file-item file">${indent}📄 ${node.name}${size}</div>`;
      }

      return html;
    }

    function sanitizeFileName(name) {
      return name
        .toLowerCase()
        .replace(/[<>:"/\\|?*\x00-\x1F]/g, '')
        .replace(/\s+/g, '-')
        .substring(0, 255);
    }

    async function callClaude(prompt, maxTokens = 2000) {
      const apiKey = document.getElementById('apiKey').value.trim();

      if (!apiKey) {
        throw new Error('Please enter your Anthropic API key');
      }

      try {
        const response = await fetch("/api/claude", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            apiKey,
            prompt,
            maxTokens
          })
        });

        if (!response.ok) {
          const error = await response.json().catch(() => ({}));
          throw new Error(error.error || `API request failed with status ${response.status}`);
        }

        const data = await response.json();
        return data.text;
      } catch (err) {
        if (err.message.includes('API request failed')) {
          throw err;
        }
        throw new Error(`Network error: ${err.message}. Check your API key and internet connection.`);
      }
    }

    async function extractRequirements(input) {
      addLog('Analyzing input and extracting requirements...', 'info');
      updateProgress('Input Processing', 10, 'Parsing requirements...');

      const prompt = `Extract skill requirements from this input as JSON:

INPUT: ${input}

Return ONLY valid JSON (no markdown):
{
  "skill_name": "lowercase-hyphenated-name",
  "description": "what it does and when to use it",
  "programming_language": "python|javascript|bash",
  "complexity": "simple|moderate|complex",
  "required_apis": ["api1", "api2"],
  "key_features": ["feature1", "feature2"],
  "needs_scripts": true|false,
  "needs_references": false
}`;

      try {
        let response = await callClaude(prompt);
        response = response.replace(/```json\s?/g, '').replace(/```\s?/g, '').trim();
        const extracted = JSON.parse(response);

        addLog(`Extracted skill: ${extracted.skill_name}`, 'success');
        updateProgress('Input Processing', 100, 'Requirements extracted');
        return extracted;
      } catch (err) {
        throw new Error(`Failed to extract requirements: ${err.message}`);
      }
    }

    async function conductResearch(requirements) {
      addLog('Starting research pipeline...', 'info');
      updateProgress('Research', 20, 'Researching documentation...');

      const prompt = `Research for creating a Claude Code Skill:

REQUIREMENTS: ${JSON.stringify(requirements, null, 2)}

Provide a focused research summary (max 1000 tokens):
1. Key technical details and APIs
2. Best practices and patterns
3. Common challenges and solutions
4. Recommended implementation approach

Be specific and actionable.`;

      try {
        const findings = await callClaude(prompt, 1500);
        addLog('Research complete', 'success');
        updateProgress('Research', 100, 'Research synthesis complete');
        return findings;
      } catch (err) {
        addLog('Research failed - using template generation', 'warning');
        return 'Limited research available - generating from templates';
      }
    }

    function sanitizeForYAML(text) {
      // Escape backslashes and double quotes for safe YAML inclusion
      return text.replace(/\\/g, '\\\\').replace(/"/g, '\\"');
    }

    function generateSafeYAML(name, description, metadata = null) {
      const lines = [];

      // Name (validated, safe without quotes if lowercase-hyphenated)
      lines.push(`name: ${name}`);

      // Description (ALWAYS quote to handle special characters)
      const safeDesc = sanitizeForYAML(description);
      lines.push(`description: "${safeDesc}"`);

      // Metadata (if provided)
      if (metadata && Object.keys(metadata).length > 0) {
        lines.push('metadata:');
        for (const [key, value] of Object.entries(metadata)) {
          // Always quote values to prevent type coercion
          const safeValue = sanitizeForYAML(String(value));
          lines.push(`  ${key}: "${safeValue}"`);
        }
      }

      return lines.join('\n');
    }

    async function generateMetadata(requirements, research) {
      addLog('Generating skill metadata...', 'info');
      updateProgress('Generate', 20, 'Creating YAML metadata...');

      const prompt = `You are generating YAML frontmatter for a Claude Code Skill.

REQUIREMENTS: ${JSON.stringify(requirements)}
RESEARCH: ${research.substring(0, 500)}

CRITICAL YAML RULES:
1. ONLY these keys allowed at root: name, description, license, allowed-tools, metadata
2. Put version, author, tags INSIDE metadata (not at root)
3. Description must include BOTH what it does AND when to use it
4. Return ONLY valid JSON with these exact fields (no YAML, no markdown):

{
  "name": "lowercase-hyphenated-name",
  "description": "Clear description with what and when. Include trigger keywords.",
  "metadata": {
    "version": "1.0.0",
    "complexity": "simple",
    "author": "Skill Factory"
  }
}

Return ONLY the JSON object, no other text.`;

      try {
        let response = await callClaude(prompt, 1000);
        response = response.replace(/```json\s?/g, '').replace(/```\s?/g, '').trim();
        const parsed = JSON.parse(response);

        // Validate name format
        if (!/^[a-z0-9-]+$/.test(parsed.name)) {
          throw new Error('Invalid name format - must be lowercase with hyphens only');
        }
        if (parsed.name.length > 64) {
          throw new Error('Name exceeds 64 character limit');
        }
        if (parsed.description.length > 1024) {
          throw new Error('Description exceeds 1024 character limit');
        }

        // Generate safe YAML using our sanitization function
        const yaml = generateSafeYAML(parsed.name, parsed.description, parsed.metadata);

        addLog('Metadata generated and validated', 'success');
        return yaml;
      } catch (err) {
        addLog(`Metadata generation failed: ${err.message}`, 'error');
        throw new Error(`Metadata generation failed: ${err.message}`);
      }
    }

    async function generateDocumentation(requirements, research, metadata) {
      addLog('Generating documentation...', 'info');
      updateProgress('Generate', 50, 'Writing SKILL.md...');

      const prompt = `Write skill documentation (WITHOUT YAML frontmatter).

REQUIREMENTS: ${JSON.stringify(requirements)}
METADATA: ${metadata}
RESEARCH: ${research}

Structure:
# Overview
Brief description

# When to Use
Trigger conditions and keywords

# Key Features
- Feature 1
- Feature 2

# Usage Examples
Concrete examples with code

# Implementation Details
Technical approach

# Best Practices
Recommendations and tips

Keep under 500 lines. Be specific and practical.`;

      try {
        const docs = await callClaude(prompt, 4000);
        addLog('Documentation generated', 'success');
        updateProgress('Generate', 100, 'Generation complete');
        return docs;
      } catch (err) {
        throw new Error(`Documentation generation failed: ${err.message}`);
      }
    }

    async function validateGeneration(skillPackage) {
      addLog('Running validation...', 'info');
      updateProgress('Validate', 50, 'Validating metadata...');

      const validation = {
        yamlValid: false,
        qualityScore: 0,
        issues: [],
        warnings: []
      };

      const hasName = skillPackage.metadata.includes('name:');
      const hasDesc = skillPackage.metadata.includes('description:');

      if (hasName && hasDesc) {
        validation.yamlValid = true;
        addLog('YAML validation passed', 'success');
      } else {
        validation.issues.push('Missing required YAML fields');
        addLog('YAML validation failed', 'error');
      }

      let score = 0;
      if (validation.yamlValid) score += 40;
      if (skillPackage.documentation.length > 500) score += 30;
      if (validation.issues.length === 0) score += 30;

      validation.qualityScore = score;

      addLog(`Quality score: ${score}/100`, score >= 70 ? 'success' : 'warning');
      updateProgress('Validate', 100, 'Validation complete');

      return validation;
    }

    async function packageSkill(skillPackage, skillName) {
      addLog('Creating skill package...', 'info');
      updateProgress('Package', 30, 'Initializing ZIP...');

      const zip = new JSZip();
      const sanitized = sanitizeFileName(skillName);
      const skillFolder = zip.folder(sanitized);

      const skillMd = `---\n${skillPackage.metadata}\n---\n\n${skillPackage.documentation}`;
      skillFolder.file('SKILL.md', skillMd);
      addLog('Added SKILL.md', 'success');

      updateProgress('Package', 60, 'Adding README...');

      const readme = `# ${skillName}

This is a Claude Code Skill package.

## Installation

1. Extract this ZIP file
2. Place the \`${sanitized}\` folder in your Claude Code skills directory:
   - Personal skills: ~/.claude/skills/
   - Project skills: .claude/skills/
3. The skill will be automatically available

## Contents

- \`SKILL.md\` - Main skill documentation

## Usage

This skill will be automatically loaded by Claude Code when relevant.
`;
      skillFolder.file('README.md', readme);
      addLog('Added README.md', 'success');

      updateProgress('Package', 80, 'Compressing...');

      const content = await zip.generateAsync({
        type: 'blob',
        compression: 'DEFLATE',
        compressionOptions: { level: 6 }
      });

      updateProgress('Package', 100, 'Package ready!');
      addLog('Package created successfully', 'success');

      const tree = {
        name: sanitized,
        type: 'folder',
        children: [
          { name: 'SKILL.md', type: 'file', size: skillMd.length },
          { name: 'README.md', type: 'file', size: readme.length }
        ]
      };

      return { content, filename: `${sanitized}.zip`, tree };
    }

    async function startGeneration() {
      const input = document.getElementById('skillInput').value.trim();
      if (!input || isGenerating) return;

      try {
        isGenerating = true;
        document.getElementById('generateBtn').disabled = true;
        document.getElementById('generateBtn').innerHTML = '⏳ Generating... <span class="loading-spinner"></span>';
        document.getElementById('inputCard').classList.add('hidden');
        document.getElementById('progressCard').classList.remove('hidden');
        document.getElementById('logContainer').innerHTML = '';

        setStep(1);

        const requirements = await extractRequirements(input);

        setStep(2);
        const research = await conductResearch(requirements);

        setStep(3);
        const metadata = await generateMetadata(requirements, research);
        const documentation = await generateDocumentation(requirements, research, metadata);

        const skillPackage = { metadata, documentation, requirements };

        setStep(4);
        const validation = await validateGeneration(skillPackage);

        if (validation.issues.length > 0) {
          throw new Error(`Validation failed: ${validation.issues.join(', ')}`);
        }

        setStep(5);
        const pkg = await packageSkill(skillPackage, requirements.skill_name);

        generatedSkillData = {
          package: pkg.content,
          filename: pkg.filename,
          tree: pkg.tree,
          validation
        };

        showResults(validation, pkg.tree, pkg.filename);
        addLog('🎉 Skill generation complete!', 'success');

      } catch (err) {
        showError(err.message);
        addLog(`Generation failed: ${err.message}`, 'error');
      } finally {
        isGenerating = false;
        document.getElementById('generateBtn').disabled = false;
        document.getElementById('generateBtn').textContent = 'Generate This Skill →';
      }
    }

    function downloadSkill() {
      if (!generatedSkillData) return;

      const url = URL.createObjectURL(generatedSkillData.package);
      const a = document.createElement('a');
      a.href = url;
      a.download = generatedSkillData.filename;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      addLog(`Downloaded ${generatedSkillData.filename}`, 'success');
    }

    async function copyPromptToClipboard() {
      if (!generatedSkillData || !generatedSkillData.package) {
        addLog('No skill available to copy', 'error');
        return;
      }

      try {
        // Extract SKILL.md content from the ZIP
        const zip = await JSZip.loadAsync(generatedSkillData.package);
        const skillMdFile = Object.keys(zip.files).find(f => f.endsWith('SKILL.md'));

        if (!skillMdFile) {
          throw new Error('SKILL.md not found in package');
        }

        const skillContent = await zip.files[skillMdFile].async('text');

        // Format as a prompt
        const prompt = `You are now equipped with the following skill:

---
${skillContent}
---

When the user asks questions or requests tasks related to the topics covered in this skill, use the knowledge and guidelines from this skill to assist them.`;

        // Try modern clipboard API first
        if (navigator.clipboard && navigator.clipboard.writeText) {
          try {
            await navigator.clipboard.writeText(prompt);
            showCopySuccess();
            addLog('Skill prompt copied to clipboard!', 'success');
          } catch (clipboardError) {
            // Clipboard API exists but rejected (Safari, insecure origin, permission denied)
            // Fall back to legacy method
            console.warn('Clipboard API rejected, using fallback:', clipboardError);
            showCopyFallback(prompt);
          }
        } else {
          // Fallback for browsers without clipboard API
          showCopyFallback(prompt);
        }

      } catch (error) {
        addLog(`Failed to copy: ${error.message}`, 'error');
        console.error('Copy error:', error);
      }
    }

    function showCopySuccess() {
      const button = document.getElementById('copyPromptBtn');
      const originalText = button.innerHTML;
      button.innerHTML = '✓ Copied!';
      button.disabled = true;

      setTimeout(() => {
        button.innerHTML = originalText;
        button.disabled = false;
      }, 2000);
    }

    function showCopyFallback(text) {
      // Create a temporary textarea for fallback copying
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.top = '0';
      textarea.style.left = '0';
      textarea.style.width = '2em';
      textarea.style.height = '2em';
      textarea.style.padding = '0';
      textarea.style.border = 'none';
      textarea.style.outline = 'none';
      textarea.style.boxShadow = 'none';
      textarea.style.background = 'transparent';

      document.body.appendChild(textarea);
      textarea.focus();
      textarea.select();

      try {
        const successful = document.execCommand('copy');
        if (successful) {
          showCopySuccess();
          addLog('Skill prompt copied to clipboard!', 'success');
        } else {
          throw new Error('Copy command failed');
        }
      } catch (err) {
        addLog('Please copy the text manually (Ctrl/Cmd+C)', 'warning');
        alert('Automatic copy failed. Please press Ctrl/Cmd+C to copy the selected text.');
      } finally {
        document.body.removeChild(textarea);
      }
    }

    function resetFactory() {
      location.reload();
    }

    init();
  </script>
</body>
</html>
